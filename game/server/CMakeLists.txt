set(PROJECT server)

set(BUILD_REPLAY 1)
set(GAME cstrike)

set(SOURCES
	#Replay
    gamedll_replay.cpp
	#src
	${SRCDIR}/game/shared/achievement_saverestore.cpp
	${SRCDIR}/game/shared/achievementmgr.cpp
	${SRCDIR}/game/shared/achievements_hlx.cpp
	${SRCDIR}/game/shared/activitylist.cpp
	ai_activity.cpp
	ai_baseactor.cpp
	ai_basehumanoid.cpp
	ai_basenpc.cpp
	ai_basenpc_flyer.cpp
	ai_basenpc_flyer_new.cpp
	ai_basenpc_movement.cpp
	ai_basenpc_physicsflyer.cpp
	ai_basenpc_schedule.cpp
	ai_basenpc_squad.cpp
	ai_behavior.cpp
	ai_behavior_assault.cpp
	ai_behavior_fear.cpp
	ai_behavior_follow.cpp
	ai_behavior_lead.cpp
	ai_behavior_rappel.cpp
	ai_behavior_standoff.cpp
	ai_blended_movement.cpp
	ai_concommands.cpp
	ai_condition.cpp
	AI_Criteria.cpp
	ai_default.cpp
	ai_dynamiclink.cpp
	ai_event.cpp
	ai_goalentity.cpp
	ai_hint.cpp
	ai_hull.cpp
	ai_initutils.cpp
	AI_Interest_Target.cpp
	ai_link.cpp
	ai_localnavigator.cpp
	ai_looktarget.cpp
	ai_memory.cpp
	ai_motor.cpp
	ai_moveprobe.cpp
	ai_moveshoot.cpp
	ai_movesolver.cpp
	ai_namespaces.cpp
	ai_navigator.cpp
	ai_network.cpp
	ai_networkmanager.cpp
	ai_node.cpp
	ai_pathfinder.cpp
	ai_planesolver.cpp
	ai_playerally.cpp
	AI_ResponseSystem.cpp
	ai_route.cpp
	ai_saverestore.cpp
	ai_schedule.cpp
	ai_scriptconditions.cpp
	ai_senses.cpp
	ai_sentence.cpp
	ai_speech.cpp
	ai_speechfilter.cpp
	ai_squad.cpp
	ai_squadslot.cpp
	ai_tacticalservices.cpp
	ai_task.cpp
	ai_trackpather.cpp
	ai_utils.cpp
	ai_waypoint.cpp
	${SRCDIR}/game/shared/ammodef.cpp
	${SRCDIR}/game/shared/animation.cpp
	${SRCDIR}/game/shared/base_playeranimstate.cpp
	base_transmit_proxy.cpp
	${SRCDIR}/game/shared/baseachievement.cpp
	baseanimating.cpp
	BaseAnimatingOverlay.cpp
	basecombatcharacter.cpp
	${SRCDIR}/game/shared/basecombatcharacter_shared.cpp
	basecombatweapon.cpp
	${SRCDIR}/game/shared/basecombatweapon_shared.cpp
	baseentity.cpp
	${SRCDIR}/game/shared/baseentity_shared.cpp
	baseflex.cpp
	${SRCDIR}/game/shared/basegrenade_shared.cpp
	basemultiplayerplayer.cpp
	${SRCDIR}/game/shared/baseparticleentity.cpp
	${SRCDIR}/game/shared/baseplayer_shared.cpp
	${SRCDIR}/game/shared/baseprojectile.cpp
	baseviewmodel.cpp
	${SRCDIR}/game/shared/baseviewmodel_shared.cpp
	${SRCDIR}/game/shared/beam_shared.cpp
	bitstring.cpp
	bmodels.cpp
	buttons.cpp
	cbase.cpp
	client.cpp
	${SRCDIR}/game/shared/collisionproperty.cpp
	colorcorrection.cpp
	colorcorrectionvolume.cpp
	CommentarySystem.cpp
	controlentities.cpp
	cplane.cpp
	CRagdollMagnet.cpp
	damagemodifier.cpp
	${SRCDIR}/game/shared/death_pose.cpp
	${SRCDIR}/game/shared/debugoverlay_shared.cpp
	${SRCDIR}/game/shared/decals.cpp
	doors.cpp
	dynamiclight.cpp
	${SRCDIR}/game/shared/effect_dispatch_data.cpp
	effects.cpp
	EffectsServer.cpp
	${SRCDIR}/game/shared/ehandle.cpp
	entityblocker.cpp
	EntityDissolve.cpp
	EntityFlame.cpp
	entitylist.cpp
	${SRCDIR}/game/shared/entitylist_base.cpp
	EntityParticleTrail.cpp
	${SRCDIR}/game/shared/EntityParticleTrail_Shared.cpp
	env_debughistory.cpp
	${SRCDIR}/game/shared/env_detail_controller.cpp
	env_effectsscript.cpp
	env_entity_maker.cpp
	env_particlescript.cpp
	env_player_surface_trigger.cpp
	env_projectedtexture.cpp
	env_screenoverlay.cpp
	env_texturetoggle.cpp
	env_tonemap_controller.cpp
	${SRCDIR}/game/shared/env_wind_shared.cpp
	env_zoom.cpp
	EnvBeam.cpp
	EnvFade.cpp
	EnvHudHint.cpp
	EnvLaser.cpp
	EnvMessage.cpp
	envmicrophone.cpp
	EnvShake.cpp
	EnvSpark.cpp
	${SRCDIR}/game/shared/eventlist.cpp
	EventLog.cpp
	explode.cpp
	filters.cpp
	fire.cpp
	fire_smoke.cpp
	fish.cpp
	fogcontroller.cpp
	fourwheelvehiclephysics.cpp
	func_areaportal.cpp
	func_areaportalbase.cpp
	func_areaportalwindow.cpp
	func_break.cpp
	func_breakablesurf.cpp
	func_dust.cpp
	${SRCDIR}/game/shared/func_ladder.cpp
	func_ladder_endpoint.cpp
	func_lod.cpp
	func_movelinear.cpp
	func_occluder.cpp
	func_reflective_glass.cpp
	func_smokevolume.cpp
	game.cpp
	game_ui.cpp
	gameinterface.cpp
	${SRCDIR}/game/shared/gamemovement.cpp
	${SRCDIR}/game/shared/gamerules.cpp
	${SRCDIR}/game/shared/gamerules_register.cpp
	${SRCDIR}/game/shared/GameStats.cpp
	${SRCDIR}/game/shared/gamestringpool.cpp
	gametrace_dll.cpp
	${SRCDIR}/game/shared/gamevars_shared.cpp
	gameweaponmanager.cpp
	genericactor.cpp
	genericmonster.cpp
	gib.cpp
	globals.cpp
	globalstate.cpp
	guntarget.cpp
	h_ai.cpp
	hierarchy.cpp
	hltvdirector.cpp
	${SRCDIR}/game/shared/hintmessage.cpp
	${SRCDIR}/game/shared/hintsystem.cpp
	${SRCDIR}/game/shared/igamesystem.cpp
	info_camera_link.cpp
	info_overlay_accessor.cpp
	intermission.cpp
	item_world.cpp
	lightglow.cpp
	lights.cpp
	logic_measure_movement.cpp
	logic_navigation.cpp
	logicauto.cpp
	logicentities.cpp
	logicrelay.cpp
	mapentities.cpp
	${SRCDIR}/game/shared/mapentities_shared.cpp
	maprules.cpp
	MaterialModifyControl.cpp
	message_entity.cpp
	modelentities.cpp
	${SRCDIR}/game/shared/ModelSoundsCache.cpp
	movehelper_server.cpp
	movement.cpp
	${SRCDIR}/game/shared/movevars_shared.cpp
	${SRCDIR}/game/shared/multiplay_gamerules.cpp
	ndebugoverlay.cpp
	npc_vehicledriver.cpp
	${SRCDIR}/game/shared/obstacle_pushaway.cpp
	particle_light.cpp
	${SRCDIR}/game/shared/particle_parse.cpp
	particle_system.cpp
	${SRCDIR}/game/shared/particlesystemquery.cpp
	pathcorner.cpp
	pathtrack.cpp
	phys_controller.cpp
	physconstraint.cpp
	physics.cpp
	physics_bone_follower.cpp
	physics_cannister.cpp
	physics_fx.cpp
	physics_impact_damage.cpp
	physics_main.cpp
	${SRCDIR}/game/shared/physics_main_shared.cpp
	physics_npc_solver.cpp
	physics_prop_ragdoll.cpp
	${SRCDIR}/game/shared/physics_saverestore.cpp
	${SRCDIR}/game/shared/physics_shared.cpp
	physobj.cpp
	player.cpp
	player_command.cpp
	player_lagcompensation.cpp
	player_pickup.cpp
	player_resource.cpp
	playerinfomanager.cpp
	playerlocaldata.cpp
	plugin_check.cpp
	${SRCDIR}/game/shared/point_bonusmaps_accessor.cpp
	point_camera.cpp
	point_devshot_camera.cpp
	point_playermoveconstraint.cpp
	${SRCDIR}/game/shared/point_posecontroller.cpp
	point_spotlight.cpp
	point_template.cpp
	pointanglesensor.cpp
	PointAngularVelocitySensor.cpp
	pointhurt.cpp
	pointteleport.cpp
	${SRCDIR}/game/shared/precache_register.cpp
	${SRCDIR}/game/shared/predictableid.cpp
	props.cpp
	${SRCDIR}/game/shared/props_shared.cpp
	${SRCDIR}/game/shared/querycache.cpp
	ragdoll_manager.cpp
	${SRCDIR}/game/shared/ragdoll_shared.cpp
	RagdollBoogie.cpp
	recipientfilter.cpp
	rope.cpp
	${SRCDIR}/game/shared/rope_helpers.cpp
	${SRCDIR}/game/shared/saverestore.cpp
	saverestore_gamedll.cpp
	${SRCDIR}/game/shared/SceneCache.cpp
	sceneentity.cpp
	${SRCDIR}/game/shared/sceneentity_shared.cpp
	scratchpad_gamedll_helpers.cpp
	scripted.cpp
	scriptedtarget.cpp
	sendproxy.cpp
	${SRCDIR}/game/shared/sequence_Transitioner.cpp
	${SRCDIR}/game/server/serverbenchmark_base.cpp
	ServerNetworkProperty.cpp
	shadowcontrol.cpp
	${SRCDIR}/game/shared/simtimer.cpp
	${SRCDIR}/game/shared/singleplay_gamerules.cpp
	SkyCamera.cpp
	slideshow_display.cpp
	sound.cpp
	${SRCDIR}/game/shared/SoundEmitterSystem.cpp
	soundent.cpp
	${SRCDIR}/game/shared/soundenvelope.cpp
	${SRCDIR}/public/SoundParametersInternal.cpp
	soundscape.cpp
	soundscape_system.cpp
	spotlightend.cpp
	${SRCDIR}/game/shared/Sprite.cpp
	sprite_perfmonitor.cpp
	${SRCDIR}/game/shared/studio_shared.cpp
	subs.cpp
	sun.cpp
	tactical_mission.cpp
	${SRCDIR}/game/shared/takedamageinfo.cpp
	tanktrain.cpp
	team.cpp
	${SRCDIR}/game/shared/teamplay_gamerules.cpp
	TemplateEntities.cpp
	tempmonster.cpp
	tesla.cpp
	${SRCDIR}/game/shared/test_ehandle.cpp
	test_proxytoggle.cpp
	test_stressentities.cpp
	testfunctions.cpp
	testtraceline.cpp
	textstatsmgr.cpp
	timedeventmgr.cpp
	trains.cpp
	triggers.cpp
	${SRCDIR}/game/shared/usercmd.cpp
	util.cpp
	${SRCDIR}/game/shared/util_shared.cpp
	variant_t.cpp
	vehicle_base.cpp
	vehicle_baseserver.cpp
	${SRCDIR}/game/shared/vehicle_viewblend_shared.cpp
	vguiscreen.cpp
	${SRCDIR}/game/shared/voice_gamemgr.cpp
	waterbullet.cpp
	WaterLODControl.cpp
	wcedit.cpp
	${SRCDIR}/game/shared/weapon_parse.cpp
	${SRCDIR}/game/shared/weapon_proficiency.cpp
	weight_button.cpp
	world.cpp
	${SRCDIR}/game/shared/mp_shareddefs.cpp
	${SRCDIR}/game/server/vote_controller.cpp
	#//Haptics
	${SRCDIR}/public/haptics/haptic_msgs.cpp
	$<$<BOOL:${WINDOWS}>:${SRCDIR}/public/haptics/haptic_utils.cpp> # [$WIN32]

	${SRCDIR}/public/bone_setup.cpp
	${SRCDIR}/public/collisionutils.cpp
	${SRCDIR}/public/dt_send.cpp
	${SRCDIR}/public/dt_utlvector_common.cpp
	${SRCDIR}/public/dt_utlvector_send.cpp
	${SRCDIR}/public/editor_sendcommand.cpp
	${SRCDIR}/public/filesystem_helpers.cpp
	gamehandle.cpp
	h_export.cpp
	init_factory.cpp
	${SRCDIR}/public/interpolatortypes.cpp
	${SRCDIR}/game/shared/interval.cpp
	${SRCDIR}/public/keyframe/keyframe.cpp
	${SRCDIR}/common/language.cpp
	${SRCDIR}/common/steamid.cpp
	${SRCDIR}/public/map_utils.cpp
	${SRCDIR}/public/networkvar.cpp
	${SRCDIR}/common/randoverride.cpp
	${SRCDIR}/public/registry.cpp
	${SRCDIR}/public/rope_physics.cpp
	${SRCDIR}/public/scratchpad3d.cpp
	${SRCDIR}/public/ScratchPadUtils.cpp
	${SRCDIR}/public/server_class.cpp
	${SRCDIR}/game/shared/sheetsimulator.cpp
	${SRCDIR}/public/simple_physics.cpp
	${SRCDIR}/public/stringregistry.cpp
	${SRCDIR}/public/studio.cpp
	GameStats_BasicStatsFunctions.cpp

	stdafx.cpp
	# temporary entities
	basetempentity.cpp
	event_tempentity_tester.cpp
	movie_explosion.cpp
	particle_fire.cpp
	particle_smokegrenade.cpp
	plasma.cpp
	smokestack.cpp
	smoke_trail.cpp
	${SRCDIR}/game/shared/SpriteTrail.cpp
	steamjet.cpp
	te.cpp
	te_armorricochet.cpp
	te_basebeam.cpp
	te_beamentpoint.cpp
	te_beaments.cpp
	te_beamfollow.cpp
	te_beamlaser.cpp
	te_beampoints.cpp
	te_beamring.cpp
	te_beamringpoint.cpp
	te_beamspline.cpp
	te_bloodsprite.cpp
	te_bloodstream.cpp
	te_breakmodel.cpp
	te_bspdecal.cpp
	te_bubbles.cpp
	te_bubbletrail.cpp
	te_clientprojectile.cpp
	te_decal.cpp
	te_dynamiclight.cpp
	te_effect_dispatch.cpp
	te_energysplash.cpp
	te_explosion.cpp
	te_fizz.cpp
	te_footprintdecal.cpp
	hl2/te_gaussexplosion.cpp
	te_glassshatter.cpp
	te_glowsprite.cpp
	te_impact.cpp
	te_killplayerattachments.cpp
	te_largefunnel.cpp
	te_muzzleflash.cpp
	te_particlesystem.cpp
	te_physicsprop.cpp
	te_playerdecal.cpp
	te_projecteddecal.cpp
	te_showline.cpp
	te_smoke.cpp
	te_sparks.cpp
	te_sprite.cpp
	te_spritespray.cpp
	te_worlddecal.cpp
	${SRCDIR}/game/shared/usermessages.cpp
# Tools Framework
	entity_tools_server.cpp
	toolframework_server.cpp
)

if(BUILD_REPLAY)
    list(APPEND SOURCES
        #Replay
        ${SRCDIR}/game/shared/replay_gamestats_shared.cpp
    )
endif()

if(${GAME} STREQUAL cstrike)
    include(server_cstrike.cmake)
endif()

add_library(${PROJECT} SHARED ${SOURCES})

target_compile_definitions(${PROJECT} PRIVATE
	GAME_DLL VECTOR VERSION_SAFE_STEAM_API_INTERFACES
	# PROTECTED_THINGS_ENABLE
	# sprintf=use_Q_snprintf_instead_of_sprintf
	strncpy=use_Q_strncpy_instead
	_snprintf=use_Q_snprintf_instead

    $<$<BOOL:${WINDOWS}>:fopen=dont_use_fopen>
    $<$<BOOL:${LINUX}>:SWDS>
    ${GAME_DEFINES}
)
target_include_directories(${PROJECT} PRIVATE
    ${SRCDIR}/game/server
    ${SRCDIR}/game/shared
    ${GAME_INCLUDES}
)

target_link_libraries(${PROJECT} PRIVATE
	choreoobjects
	particles
	dmxloader
	tier0 tier1 tier2 tier3
	mathlib
	vstdlib
	steam_api
    $<$<BOOL:${LINUX}>:rt>
	$<$<BOOL:${WINDOWS}>:dinput8.lib winmm.lib wsock32.lib ws2_32.lib wininet.lib vfw32.lib rpcrt4.lib>
)
install(TARGETS ${PROJECT} DESTINATION ${GAME}/bin)